<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Withdrawal History</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="main_style.css">

    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    
</head>
<body>
    <div class="app-container">
        <div class="header">
            <div class="logo">
                <button class="action-btn back-btn" id="history-back-btn" style="margin-right: 10px;">
                    <i class="fas fa-arrow-left"></i>
                </button>
                <h1>Withdrawal History</h1>
            </div>
        </div>

        <div class="content" id="history-page-content" style="padding: 20px;">
            <div id="history-list">
                <p style="text-align: center; color: var(--tg-theme-hint-color);">Loading history...</p>
            </div>
        </div>
    </div>

    <script>
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyDmJ8wsK6sYlRX2DWYTFmxwZONCL9nsmos",
            authDomain: "ensen-mining-bd-4882b.firebaseapp.com",
            databaseURL: "https://ensen-mining-bd-4882b-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "ensen-mining-bd-4882b",
            storageBucket: "ensen-mining-bd-4882b.firebasestorage.app",
            messagingSenderId: "1006758844776",
            appId: "1:1006758844776:web:df590613a79e1e9eed1edd",
            measurementId: "G-8YKDVM1W8B"
        };
        firebase.initializeApp(firebaseConfig);
        const firestore = firebase.firestore();
        
        // IMPORTANT: This user ID should come from your login/authentication system.
        const userId = 'user_001';

        document.addEventListener('DOMContentLoaded', function() {
            const historyListEl = document.getElementById('history-list');
            const historyBackBtn = document.getElementById('history-back-btn');

            // Load history from Firestore
            firestore.collection('withdrawals').where('userId', '==', userId).orderBy('date', 'desc').get()
                .then(snapshot => {
                    historyListEl.innerHTML = ''; // Clear loading text
                    if (snapshot.empty) {
                        historyListEl.innerHTML = '<p style="text-align: center; color: var(--tg-theme-hint-color);">No withdrawal history found.</p>';
                        return;
                    }
                    snapshot.forEach(doc => {
                        const item = doc.data();
                        const historyItem = document.createElement('div');
                        historyItem.classList.add('history-item');
                        historyItem.innerHTML = `
                            <div>
                                <p><strong>Amount:</strong> à§³${item.amount}</p>
                                <p><strong>Method:</strong> ${item.method}</p>
                                <p><strong>Date:</strong> ${new Date(item.date).toLocaleDateString()}</p>
                            </div>
                            <span class="status ${item.status.toLowerCase()}">${item.status}</span>
                        `;
                        historyListEl.appendChild(historyItem);
                    });
                })
                .catch(error => {
                    console.error("Error fetching withdrawal history: ", error);
                    historyListEl.innerHTML = '<p style="text-align: center; color: red;">Error loading history.</p>';
                });

            historyBackBtn.addEventListener('click', () => {
                window.location.href = 'main.html';
            });
        });
    </script>
</body>
</html>
