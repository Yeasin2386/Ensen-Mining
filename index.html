<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Sleek Mini App</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --bg-color: #1a1a1a; --card-color: #2c2c2c; --text-color: #f0f0f0; --secondary-text-color: #b0b0b0;
            --accent-color: #00d68f; --button-color: #00d68f; --button-text-color: #1a1a1a; --border-color: #444;
            --telegram-color: #0088cc; --whatsapp-color: #25D366; --gmail-color: #EA4335; --instagram-color: #E1306C;
            --facebook-color: #1877F2;
        }
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; background: linear-gradient(200deg, #1b263b, #0d1b2a, #1a1a1a); background-size: 400% 400%; animation: gradientBG 20s ease infinite; color: var(--text-color); display: flex; flex-direction: column; min-height: 100vh; }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }
        .container { max-width: 500px; width: 100%; margin: auto; padding: 20px; box-sizing: border-box; text-align: center; flex-grow: 1; padding-bottom: 80px; }
        .header { text-align: center; margin-bottom: 25px; animation: slideInDown 0.6s ease-out; display: flex; align-items: center; justify-content: center; position: relative; }
        .header .back-btn { position: absolute; left: 0; font-size: 1.5em; color: var(--secondary-text-color); cursor: pointer; }
        h2 { color: #fff; margin: 0; flex-grow: 1; }
        .balance-card { background: var(--card-color); padding: 20px; border-radius: 12px; margin-bottom: 25px; box-shadow: 0 4px 15px rgba(0, 0, 0, 0.5); display: flex; align-items: center; justify-content: space-between; border-left: 4px solid var(--accent-color); animation: fadeInScale 0.8s ease-out; }
        .balance-info { text-align: left; }
        .balance-text { font-size: 0.9em; color: var(--secondary-text-color); margin: 0; }
        .balance-value { font-size: 1.8em; font-weight: bold; color: var(--accent-color); margin: 5px 0 0 0; }
        .balance-icon { font-size: 2.5em; color: var(--border-color); }
        .button { display: block; width: 100%; padding: 18px; margin-top: 25px; background-color: var(--button-color); color: var(--button-text-color); text-decoration: none; border-radius: 10px; font-size: 1.1em; font-weight: bold; cursor: pointer; border: none; }
        .screen { display: none; padding: 20px; box-sizing: border-box; }
        .screen.active { display: flex; justify-content: center; align-items: center; flex-direction: column; min-height: 100vh; }
        .form-container { background-color: var(--card-color); padding: 30px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5); width: 100%; max-width: 350px; text-align: center; }
        .form-container h3 { margin-top: 0; margin-bottom: 25px; color: #fff; font-size: 1.5em; }
        .input-group { text-align: left; margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; color: var(--secondary-text-color); font-size: 0.9em; }
        .input-group input, .input-group select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border-color); background-color: #1f1f1f; color: var(--text-color); font-size: 1em; box-sizing: border-box; }
        .alert-box { border-left: 4px solid; padding: 15px; border-radius: 8px; margin-top: 20px; margin-bottom: 20px; text-align: left; }
        .nav-bar { background-color: var(--card-color); border-top: 1px solid var(--border-color); display: flex; justify-content: space-around; padding: 15px 0; position: fixed; bottom: 0; width: 100%; max-width: 500px; margin: 0 auto; box-shadow: 0 -4px 15px rgba(0, 0, 0, 0.5); border-radius: 15px 15px 0 0; z-index: 100; }
        .nav-item { text-align: center; color: var(--secondary-text-color); font-size: 0.8em; text-decoration: none; cursor: pointer; padding: 5px; }
        .nav-item i { font-size: 1.5em; margin-bottom: 5px; display: block; }
        .nav-item.active { color: var(--accent-color); }
        .content-section { display: none; animation: fadeIn 0.5s; }
        .content-section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .task-list-item { display: flex; align-items: center; gap: 15px; background-color: var(--card-color); padding: 15px; margin-bottom: 15px; border-radius: 10px; text-align: left; border-left: 3px solid transparent; }
        .task-list-item .task-icon { font-size: 1.5em; width: 25px; text-align: center; }
        .ad-icon { color: var(--accent-color); }
        .facebook-icon { color: var(--facebook-color); }
        .instagram-icon { color: var(--instagram-color); }
        .whatsapp-icon { color: var(--whatsapp-color); }
        .gmail-icon { color: var(--gmail-color); }
        #file-upload-section { display: flex; flex-direction: column; align-items: center; border: 2px dashed var(--border-color); border-radius: 8px; padding: 20px; margin-bottom: 15px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="registration-screen" class="screen active">
        <div class="form-container">
            <h3>Complete your Profile üìù</h3>
            <div class="input-group"><label for="reg-username">Username</label><input type="text" id="reg-username"></div>
            <div class="input-group"><label for="reg-nickname">Nickname</label><input type="text" id="reg-nickname"></div>
            <div class="input-group"><label for="reg-phone">Phone Number</label><input type="tel" id="reg-phone"></div>
            <div class="input-group"><label for="reg-password">Transaction Password (6 digits)</label><input type="password" id="reg-password" maxlength="6"></div>
            <button class="button" onclick="registerUser()">Register</button>
        </div>
    </div>

    <div id="activation-screen" class="screen">
        <div class="form-container">
            <h3>Activate Your Account üöÄ</h3>
            <div class="alert-box" style="background-color: rgba(0, 214, 143, 0.1); border-color: var(--accent-color);">
                <p>‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶ü‡¶ø ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡¶§‡ßá, ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá <strong id="activationFee"></strong> ‡¶ü‡¶æ‡¶ï‡¶æ ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡ßá Send Money ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
                <h4 style="color: #fff; text-align: center; margin: 10px 0;">‡¶®‡¶Æ‡ßç‡¶¨‡¶∞: <span id="paymentNumber"></span></h4>
                <p>‡¶ü‡¶æ‡¶ï‡¶æ ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã‡¶∞ ‡¶™‡¶∞, ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶¨‡¶ï‡ßç‡¶∏‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Transaction ID ‡¶¶‡¶ø‡¶®‡•§</p>
            </div>
            <div class="input-group"><label for="txn-id">Transaction ID</label><input type="text" id="txn-id"></div>
            <button class="button" onclick="submitActivation()">Submit for Review</button>
        </div>
    </div>

    <div id="pending-screen" class="screen">
        <div class="form-container">
            <h3>Account Pending Approval ‚è≥</h3>
            <p style="color: var(--secondary-text-color);">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶ü‡¶ø‡¶≠‡ßá‡¶∂‡¶® ‡¶Ö‡¶®‡ßÅ‡¶∞‡ßã‡¶ß ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶Ø‡¶æ‡¶ö‡¶æ‡¶á ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü‡¶ü‡¶ø ‡¶∏‡¶ï‡ßç‡¶∞‡¶ø‡¶Ø‡¶º ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§ ‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§</p>
        </div>
    </div>

    <div id="main-app" class="screen">
        <div class="container">
            <div id="home" class="content-section active">
                <div class="header"><h2>Welcome, <span id="welcome-nickname"></span> üëã</h2></div>
                <div class="balance-card">
                    <div class="balance-info"><p class="balance-text">Current Balance</p><h1 class="balance-value" id="balanceDisplay">0 BDT</h1></div>
                    <i class="fas fa-wallet balance-icon"></i>
                </div>
                <div class="rates-list-card task-list-item">
                    <div>
                        <h3>Today's Rates ‚ú®</h3>
                        <div id="rates-container"></div>
                    </div>
                </div>
            </div>
            <div id="tasks" class="content-section">
                <div class="header"><h2>Tasks üöÄ</h2></div>
                <div class="task-list-item"><i class="fas fa-ad task-icon ad-icon"></i><div><h4>Watch Ads</h4><p>Watch ads to earn <span id="adTaskRate"></span> BDT.</p></div><button class="button" style="padding: 10px 15px; margin: 0;" onclick="updateBalance('adWatch')">Watch</button></div>
            </div>
            <div id="extra-earning" class="content-section">
                <div class="header"><h2>Extra Earning üí∞</h2></div>
                <div class="task-list-item" onclick="showSection('gmail-sell')"><i class="fas fa-envelope task-icon gmail-icon"></i><div><h4>Sell Gmail Account</h4><p>Sell your Gmail for <span id="gmailTaskRate"></span> BDT.</p></div></div>
                <div class="task-list-item" onclick="showSection('instagram-sell')"><i class="fab fa-instagram task-icon instagram-icon"></i><div><h4>Sell Instagram Account</h4><p>Sell your Instagram for <span id="instagramTaskRate"></span> BDT.</p></div></div>
            </div>
            <div id="settings" class="content-section">
                 <div class="header"><h2>Settings ‚öôÔ∏è</h2></div>
                 <div class="task-list-item" onclick="showSection('withdraw-page')"><i class="fas fa-wallet"></i><h4>Withdraw</h4></div>
                 <div class="task-list-item" onclick="showSection('history-page')"><i class="fas fa-history"></i><h4>Withdrawal History</h4></div>
            </div>
             <div id="withdraw-page" class="content-section">
                <div class="header"><i class="fas fa-arrow-left back-btn" onclick="showSection('settings')"></i><h2>Withdraw üí∏</h2></div>
                <div class="input-group"><label for="amount">Amount (BDT)</label><input type="number" id="amount"></div>
                <div class="input-group"><label for="method">Method</label><select id="method"><option value="bkash">bKash</option><option value="binance">Binance</option></select></div>
                <div class="input-group"><label for="account">Account Number/ID</label><input type="text" id="account"></div>
                <div class="input-group"><label for="transaction-password">Transaction Password</label><input type="password" id="transaction-password"></div>
                <button class="button" onclick="requestWithdraw()">Request Withdraw</button>
            </div>
            <div id="history-page" class="content-section">
                <div class="header"><i class="fas fa-arrow-left back-btn" onclick="showSection('settings')"></i><h2>Withdrawal History üìú</h2></div>
                <div id="history-container"></div>
            </div>
            <div id="gmail-sell" class="content-section">
                <div class="header"><i class="fas fa-arrow-left back-btn" onclick="showSection('extra-earning')"></i><h2>Sell Gmail Account üìß</h2></div>
                <div class="alert-box" style="border-color: #ff4d4f;"><h4>‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ! ‚ö†Ô∏è</h4><p>‡¶ú‡¶ø‡¶Æ‡ßá‡¶á‡¶≤ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶≤‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶æ‡¶¨‡ßá‡¶® ‡¶®‡¶æ‡•§</p></div>
                <div id="file-upload-section" onclick="document.getElementById('gmail-file').click();"><i class="fas fa-file-upload"></i><p>‡¶´‡¶æ‡¶á‡¶≤ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶® (.txt)</p><input type="file" id="gmail-file" accept=".txt" style="display: none;"></div>
                <button class="button" onclick="submitFile('gmail')">‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü</button>
            </div>
            <div id="instagram-sell" class="content-section">
                <div class="header"><i class="fas fa-arrow-left back-btn" onclick="showSection('extra-earning')"></i><h2>Sell Instagram Account üì∏</h2></div>
                <div class="alert-box" style="border-color: #ff4d4f;"><h4>‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ! ‚ö†Ô∏è</h4><p>‡¶á‡¶®‡¶∏‡ßç‡¶ü‡¶æ‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶¶‡ßá‡¶ì‡ßü‡¶æ‡¶∞ ‡¶™‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡¶≤‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶æ‡¶¨‡ßá‡¶® ‡¶®‡¶æ‡•§</p></div>
                <div id="file-upload-section" onclick="document.getElementById('insta-file').click();"><i class="fas fa-file-upload"></i><p>‡¶´‡¶æ‡¶á‡¶≤ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶® (.txt)</p><input type="file" id="insta-file" accept=".txt" style="display: none;"></div>
                <button class="button" onclick="submitFile('instagram')">‡¶∏‡¶æ‡¶¨‡¶Æ‡¶ø‡¶ü</button>
            </div>
        </div>
        <div class="nav-bar">
            <a class="nav-item active" onclick="showSection('home', this)"><i class="fas fa-home"></i><span>Home</span></a>
            <a class="nav-item" onclick="showSection('tasks', this)"><i class="fas fa-tasks"></i><span>Tasks</span></a>
            <a class="nav-item" onclick="showSection('extra-earning', this)"><i class="fas fa-coins"></i><span>Extra</span></a>
            <a class="nav-item" onclick="showSection('settings', this)"><i class="fas fa-cog"></i><span>Settings</span></a>
        </div>
    </div>

    <script>
        let config = {};
        let userData = {};
        const API_URL = 'api.php';

        async function apiRequest(action, body) {
            const isFormData = body instanceof FormData;
            const options = {
                method: 'POST',
                headers: isFormData ? {} : { 'Content-Type': 'application/json' },
                body: isFormData ? body : JSON.stringify({ action, ...body })
            };
            const response = await fetch(API_URL, options);
            return response.json();
        }

        function switchScreen(screenId) {
            document.querySelectorAll('.screen').forEach(s => { s.style.display = 'none'; s.classList.remove('active'); });
            const screen = document.getElementById(screenId);
            screen.style.display = 'flex';
            screen.classList.add('active');
        }

        async function initializeApp() {
            const configResponse = await apiRequest('getConfig');
            if (configResponse.status === 'success') {
                config = configResponse.config;
                document.getElementById('activationFee').textContent = config.activationFee;
                document.getElementById('paymentNumber').textContent = config.paymentNumber;
            }

            const userId = localStorage.getItem('userId');
            if (userId) {
                const userResponse = await apiRequest('getUserData', { userId });
                if (userResponse.status === 'success' && userResponse.user) {
                    userData = userResponse.user;
                    if (userData.status === 'active') {
                        switchScreen('main-app');
                        updateUI();
                    } else if (userData.status === 'pending_activation') {
                        switchScreen('pending-screen');
                    } else {
                        localStorage.removeItem('userId');
                        switchScreen('registration-screen');
                    }
                } else {
                    localStorage.removeItem('userId');
                    switchScreen('registration-screen');
                }
            } else {
                switchScreen('registration-screen');
            }
        }
        
        async function registerUser() {
            const user = {
                username: document.getElementById('reg-username').value.trim(),
                nickname: document.getElementById('reg-nickname').value.trim(),
                phone: document.getElementById('reg-phone').value.trim(),
                transactionPassword: document.getElementById('reg-password').value.trim()
            };
            if (Object.values(user).some(v => !v)) return alert("Please fill all fields.");
            if (user.phone.length !== 11 || isNaN(user.phone)) return alert("Phone number must be 11 digits.");
            if (user.transactionPassword.length !== 6 || isNaN(user.transactionPassword)) return alert("Password must be 6 digits.");
            
            const response = await apiRequest('registerUser', { user });
            if (response.status === 'success') {
                localStorage.setItem('tempUserId', response.userId);
                switchScreen('activation-screen');
            } else {
                alert(response.message);
            }
        }

        async function submitActivation() {
            const userId = localStorage.getItem('tempUserId');
            const activationTxId = document.getElementById('txn-id').value.trim();
            if (!activationTxId) return alert("Please enter the transaction ID.");
            
            const response = await apiRequest('submitActivation', { userId, activationTxId });
            if (response.status === 'success') {
                localStorage.setItem('userId', userId);
                localStorage.removeItem('tempUserId');
                switchScreen('pending-screen');
            } else {
                alert(response.message);
            }
        }
        
        function updateUI() {
            document.getElementById('welcome-nickname').textContent = userData.nickname;
            document.getElementById('balanceDisplay').textContent = `${userData.balance.toLocaleString()} BDT`;
            
            document.getElementById('rates-container').innerHTML = `
                <p>Gmail Account: ${config.gmailRate} BDT</p>
                <p>Instagram Account: ${config.instagramRate} BDT</p>
                <p>Per Ad View: ${config.adRate} BDT</p>`;

            document.getElementById('adTaskRate').textContent = config.adRate;
            document.getElementById('gmailTaskRate').textContent = config.gmailRate;
            document.getElementById('instagramTaskRate').textContent = config.instagramRate;

            const historyContainer = document.getElementById('history-container');
            if (userData.withdrawalHistory && userData.withdrawalHistory.length > 0) {
                historyContainer.innerHTML = userData.withdrawalHistory.map(h => 
                    `<div class="task-list-item"><span>${h.date} - ${h.amount} BDT (${h.method})</span><span>${h.status}</span></div>`
                ).join('');
            } else {
                historyContainer.innerHTML = '<p>No history available.</p>';
            }
        }

        async function updateBalance(taskType) {
            const response = await apiRequest('updateBalance', { userId: userData.id, taskType });
            if (response.status === 'success') {
                alert(response.message);
                userData = response.user;
                updateUI();
            } else {
                alert(response.message);
            }
        }

        async function requestWithdraw() {
            const withdrawData = {
                userId: userData.id,
                amount: parseInt(document.getElementById('amount').value),
                method: document.getElementById('method').value,
                account: document.getElementById('account').value,
                password: document.getElementById('transaction-password').value,
            };
            if (!withdrawData.amount || !withdrawData.account || !withdrawData.password) return alert("Please fill all fields.");

            const response = await apiRequest('requestWithdraw', withdrawData);
            if(response.status === 'success') {
                alert(response.message);
                userData = response.user;
                updateUI();
                showSection('settings');
            } else {
                alert(response.message);
            }
        }

        async function submitFile(type) {
            const fileInput = document.getElementById(type === 'gmail' ? 'gmail-file' : 'insta-file');
            if (fileInput.files.length === 0) return alert('Please select a file.');

            const formData = new FormData();
            formData.append('action', 'submitFile');
            formData.append('userId', userData.id);
            formData.append('type', type);
            formData.append('file', fileInput.files[0]);

            const response = await apiRequest(null, formData);
            alert(response.message);
            if (response.status === 'success') {
                showSection('extra-earning');
            }
        }
        
        function showSection(sectionId, element = null) {
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            document.getElementById(sectionId).classList.add('active');

            if (element) {
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                element.classList.add('active');
            }
        }
        
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
